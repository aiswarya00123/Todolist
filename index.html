<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f7f7fa 100%);
            min-height: 100vh;
            padding: 2em;
        }
        .container-todo {
            max-width: 850px;
            margin: 0 auto;
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(60,60,120,0.13), 0 1.5px 4px rgba(0,0,0,0.06);
            padding: 2.5em 2em;
        }
        .todo-list li {
            background: linear-gradient(90deg, #f8faff 80%, #e0e7ff 100%);
            margin-bottom: 0.7em;
            padding: 1em 1.2em;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(60,60,120,0.07);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s, box-shadow 0.2s;
            border-left: 5px solid #0078d7;
        }
        .todo-list li.completed {
            color: #b3b3b3;
            background: #f0f0f0;
            border-left: 5px solid #b3b3b3;
        }
        .due-date-label {
            font-size: 0.95em;
            color: #0078d7;
            margin-left: 1em;
            background: #e0e7ff;
            padding: 0.3em 0.7em;
            border-radius: 6px;
            white-space: nowrap;
        }
        .btn i {
            margin-right: 4px;
        }
        .btn {
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        @media (max-width: 600px) {
            .todo-list li {
                flex-direction: column;
                align-items: flex-start;
            }
            .due-date-label {
                margin-left: 0;
                margin-top: 0.5em;
            }
        }
    </style>
</head>
<body>

<div class="container-todo shadow">
    <h1 class="text-center mb-4 fw-bold text-primary">Todo List</h1>

    <!-- Search and Export -->
    <div class="row g-2 align-items-center mb-4">
        <div class="col-md-6">
            <input type="text" id="searchInput" class="form-control" placeholder="Search todos...">
        </div>
        <div class="col-auto">
            <button class="btn btn-outline-secondary" type="button" onclick="searchAndRender()">
                <i class="bi bi-search"></i> Search
            </button>
            <button class="btn btn-outline-dark" type="button" onclick="clearSearch()">
                <i class="bi bi-x-circle"></i> Clear
            </button>
        </div>
        <div class="col-auto ms-auto">
            <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-download"></i> Export As
                </button>
                <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                    <li><a class="dropdown-item" href="#" onclick="exportTodos('json')">JSON Text</a></li>
                    <li><a class="dropdown-item" href="#" onclick="exportTodos('plain')">Plain Text</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Add Todo -->
    <form class="row g-2 mb-4" onsubmit="addTodoFromInput(); return false;">
        <div class="col-md-6">
            <input type="text" id="todoInput" class="form-control" placeholder="Add a new todo">
        </div>
        <div class="col-md-4">
            <input type="date" id="dueDateInput" class="form-control">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-plus-circle"></i> Add
            </button>
        </div>
    </form>

    <!-- Todo List -->
    <ul id="todoList" class="todo-list list-unstyled"></ul>
</div>

<!-- JavaScript -->
<script>
    let todos = [];
    let searchResults = null;

    function saveTodosToStorage() {
        localStorage.setItem('todos', JSON.stringify(todos));
    }

    function loadTodosFromStorage() {
        const data = localStorage.getItem('todos');
        todos = data ? JSON.parse(data) : [];
    }

    function renderTodos() {
        const list = document.getElementById('todoList');
        list.innerHTML = '';
        const items = searchResults ?? todos;

        items.forEach((todo, i) => {
            const li = document.createElement('li');
            li.className = todo.status === "Completed" ? 'completed' : '';

            const tickBtn = document.createElement('button');
            tickBtn.className = 'btn btn-outline-success btn-sm me-2';
            tickBtn.innerHTML = todo.status === "Completed"
                ? '<i class="bi bi-check2-circle"></i>'
                : '<i class="bi bi-circle"></i>';
            tickBtn.title = todo.status === "Completed" ? "Completed" : "Mark as completed";
            tickBtn.disabled = todo.status === "Completed";
            tickBtn.onclick = () => {
                completeTodo(i);
                saveTodosToStorage();
                renderTodos();
            };
            li.appendChild(tickBtn);

            const span = document.createElement('span');
            span.textContent = todo.task;
            span.style.flex = '1';
            li.appendChild(span);

            const statusBadge = document.createElement('span');
            statusBadge.className = 'badge ms-2 ' + (todo.status === "Completed" ? 'bg-success' : 'bg-warning text-dark');
            statusBadge.textContent = todo.status;
            li.appendChild(statusBadge);

            if (todo.dueDate) {
                const due = document.createElement('span');
                due.textContent = "Due: " + todo.dueDate;
                due.className = "due-date-label";
                li.appendChild(due);
            }

            const editBtn = document.createElement('button');
            editBtn.textContent = 'Edit';
            editBtn.className = 'btn btn-info btn-sm me-1 text-white';
            editBtn.onclick = (e) => {
                e.stopPropagation();
                startEdit(i);
            };
            li.appendChild(editBtn);

            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.className = 'btn btn-danger btn-sm ms-1';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeTodo(i);
                saveTodosToStorage();
                renderTodos();
            };
            li.appendChild(removeBtn);

            list.appendChild(li);
        });
    }

    function searchAndRender() {
        const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
        searchResults = keyword
            ? todos.filter(todo =>
                todo.task.toLowerCase().includes(keyword) ||
                (todo.dueDate && todo.dueDate.toLowerCase().includes(keyword)))
            : null;
        renderTodos();
    }

    function clearSearch() {
        document.getElementById('searchInput').value = '';
        searchResults = null;
        renderTodos();
    }

    function completeTodo(index) {
        (searchResults ?? todos)[index].status = "Completed";
    }

    function removeTodo(index) {
        const arr = searchResults ?? todos;
        const todoToRemove = arr[index];
        todos = todos.filter(todo => todo !== todoToRemove);
        searchResults = null;
    }

    function startEdit(index) {
        const task = prompt("Edit your task:", (searchResults ?? todos)[index].task);
        const due = prompt("Edit due date (YYYY-MM-DD):", (searchResults ?? todos)[index].dueDate);
        if (task) saveEdit(index, task, due);
    }

    function saveEdit(index, newTask, newDueDate) {
        const arr = searchResults ?? todos;
        arr[index].task = newTask.trim() || arr[index].task;
        arr[index].dueDate = newDueDate;
        saveTodosToStorage();
        renderTodos();
    }

    function addTodo(task, dueDate) {
        todos.push({
            task,
            dueDate,
            status: "Pending"
        });
    }

    function addTodoFromInput() {
        const input = document.getElementById('todoInput');
        const dueInput = document.getElementById('dueDateInput');
        const task = input.value.trim();
        const dueDate = dueInput.value;
        if (task && dueDate) {
            addTodo(task, dueDate);
            input.value = '';
            dueInput.value = '';
            searchResults = null;
            saveTodosToStorage();
            renderTodos();
        } else {
            alert("Please enter both a task and a due date.");
        }
    }

    function exportTodos(type) {
        const data = todos.map(t => `${t.task} [${t.dueDate}] - ${t.status}`);
        const json = JSON.stringify(todos, null, 2);
        const blob = new Blob(
            [type === 'json' ? json : data.join('\n')],
            { type: 'text/plain;charset=utf-8' }
        );
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `todos.${type === 'json' ? 'json' : 'txt'}`;
        link.click();
    }

    // Init
    loadTodosFromStorage();
    renderTodos();
</script>

</body>
</html>
