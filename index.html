<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo List</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f7f7fa 100%);
            min-height: 100vh;
        }
        .container-todo {
            max-width: 800px;
            margin: 3em auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(60,60,120,0.10), 0 1.5px 4px rgba(0,0,0,0.04);
            padding: 2.5em 2em 2em 2em;
        }
        .todo-list li {
            background: #f8faff;
            margin-bottom: 0.7em;
            padding: 0.85em 1em;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }
        .todo-list li.completed {
            text-decoration: line-through;
            color: #b3b3b3;
            background: #f0f0f0;
        }
        .todo-list li:not(.completed):hover {
            background: #e6f0fa;
        }
        .todo-list .due-date-label {
            font-size: 0.95em;
            color: #888;
            margin-left: 1em;
            white-space: nowrap;
        }
        .todo-list button {
            margin-left: 0.5em;
        }
        .search-row {
            display: flex;
            flex-wrap: nowrap;
            gap: 0.5em;
            margin-bottom: 1.2em;
        }
        @media (max-width: 600px) {
            .container-todo {
                padding: 1.2em 0.5em;
            }
            .input-row, .search-row {
                flex-direction: column !important;
            }
            .input-row > *, .search-row > * {
                width: 100% !important;
                margin-bottom: 0.7em !important;
            }
        }
    </style>
</head>
<body>
   <div class="container-todo shadow">
    <h1 class="text-center mb-4 fw-bold" style="color:#2d3a4a;">Todo List</h1>
    <!-- Search functionality at the top -->
    <div class="search-row d-flex flex-nowrap align-items-center gap-2 mb-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Search todos..." style="width:70%;">
        <button class="btn btn-outline-secondary" type="button" onclick="searchAndRender()">Search</button>
        <button class="btn btn-outline-dark" type="button" onclick="clearSearch()">Clear</button>
    </div>
    <form class="input-row d-flex flex-nowrap align-items-center gap-2 mb-3" onsubmit="addTodoFromInput(); return false;">
        <input type="text" id="todoInput" class="form-control" placeholder="Add a new todo" style="width:50%;min-width:120px;">
        <input type="date" id="dueDateInput" class="form-control" style="width:35%;min-width:110px;">
        <button type="submit" class="btn btn-primary" style="width:auto;min-width:70px;white-space:nowrap;">Add</button>
    </form>
    <ul id="todoList" class="todo-list list-unstyled"></ul>
</div>
    <script src="todo.js"></script>
    <script>
        let searchResults = null;

        // --- LocalStorage Support ---
        function saveTodosToStorage() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }
        function loadTodosFromStorage() {
            const data = localStorage.getItem('todos');
            if (data) {
                todos = JSON.parse(data);
            } else {
                todos = [];
            }
        }

        function renderTodos() {
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            const items = searchResults !== null ? searchResults : todos;
            items.forEach((todo, i) => {
                const li = document.createElement('li');
                li.className = 'd-flex align-items-center ' + (todo.completed ? 'completed' : '');

                if (todo.editing) {
                    const editInput = document.createElement('input');
                    editInput.type = 'text';
                    editInput.value = todo.task;
                    editInput.className = 'form-control me-2';
                    editInput.style.flex = '1';
                    editInput.onkeydown = (e) => {
                        if (e.key === 'Enter') saveEdit(i, editInput.value, editDue.value);
                        if (e.key === 'Escape') cancelEdit(i);
                    };
                    li.appendChild(editInput);

                    const editDue = document.createElement('input');
                    editDue.type = 'date';
                    editDue.value = todo.dueDate || '';
                    editDue.className = 'form-control me-2';
                    editDue.style.width = '140px';
                    li.appendChild(editDue);

                    const saveBtn = document.createElement('button');
                    saveBtn.textContent = 'Save';
                    saveBtn.className = 'btn btn-success btn-sm save-btn me-1';
                    saveBtn.onclick = () => saveEdit(i, editInput.value, editDue.value);
                    li.appendChild(saveBtn);

                    const cancelBtn = document.createElement('button');
                    cancelBtn.textContent = 'Cancel';
                    cancelBtn.className = 'btn btn-secondary btn-sm cancel-btn';
                    cancelBtn.onclick = () => cancelEdit(i);
                    li.appendChild(cancelBtn);
                } else {
                    const span = document.createElement('span');
                    span.textContent = todo.task;
                    span.style.flex = '1';
                    span.style.cursor = 'pointer';
                    span.title = 'Click to mark as completed';
                    span.onclick = () => {
                        completeTodo(i);
                        saveTodosToStorage();
                        renderTodos();
                    };
                    li.appendChild(span);

                    // Show due date if present
                    if (todo.dueDate) {
                        const due = document.createElement('span');
                        due.textContent = "Due: " + todo.dueDate;
                        due.className = "due-date-label";
                        li.appendChild(due);
                    }

                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Edit';
                    editBtn.className = 'btn btn-info btn-sm edit-btn me-1 text-white';
                    editBtn.onclick = (e) => {
                        e.stopPropagation();
                        startEdit(i);
                    };
                    li.appendChild(editBtn);

                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Remove';
                    removeBtn.className = 'btn btn-danger btn-sm ms-1';
                    removeBtn.onclick = (e) => {
                        e.stopPropagation();
                        removeTodo(i);
                    };
                    li.appendChild(removeBtn);
                }
                list.appendChild(li);
            });
        }

        function searchAndRender() {
            const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!keyword) {
                searchResults = null;
                renderTodos();
                return;
            }
            searchResults = todos.filter(todo =>
                todo.task.toLowerCase().includes(keyword) ||
                (todo.dueDate && todo.dueDate.toLowerCase().includes(keyword))
            );
            renderTodos();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            searchResults = null;
            renderTodos();
        }

        function startEdit(index) {
            (searchResults || todos)[index].editing = true;
            renderTodos();
        }

        function saveEdit(index, newTask, newDueDate) {
            const arr = searchResults || todos;
            arr[index].task = newTask.trim() || arr[index].task;
            arr[index].dueDate = newDueDate;
            arr[index].editing = false;
            saveTodosToStorage();
            renderTodos();
        }

        function cancelEdit(index) {
            (searchResults || todos)[index].editing = false;
            renderTodos();
        }

        function addTodoFromInput() {
            const input = document.getElementById('todoInput');
            const dueInput = document.getElementById('dueDateInput');
            const task = input.value.trim();
            const dueDate = dueInput.value;
            if (task && dueDate) { // Require both task and due date
                addTodo(task, dueDate);
                input.value = '';
                dueInput.value = '';
                searchResults = null;
                saveTodosToStorage();
                renderTodos();
            } else {
                alert("Please enter both a task and a due date.");
            }
        }

        // --- Override removeTodo to support localStorage ---
        function removeTodo(index) {
            if (index >= 0 && index < todos.length) {
                todos.splice(index, 1);
                saveTodosToStorage();
                renderTodos();
            }
        }

        // --- Load from localStorage on page load ---
        loadTodosFromStorage();
        renderTodos();
    </script>